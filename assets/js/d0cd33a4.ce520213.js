"use strict";(self.webpackChunkuser_guide=self.webpackChunkuser_guide||[]).push([[4539],{3838:(e,a,t)=>{t.r(a),t.d(a,{contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var r=t(8168),n=(t(6540),t(5680));const i={sidebar_position:2,title:"Standards"},o=void 0,s={unversionedId:"macros/macros-standards",id:"macros/macros-standards",title:"Standards",description:"These macro conventions are to improve the usability, reliability, and efficiency of our code.",source:"@site/docs/macros/macros-standards.md",sourceDirName:"macros",slug:"/macros/macros-standards",permalink:"/user-guide/docs/macros/macros-standards",editUrl:"https://github.com/Emanate-Biostats-Inc/user-guide/blob/master/docs/macros/macros-standards.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2,title:"Standards"},sidebar:"macrosSidebar",previous:{title:"Intro",permalink:"/user-guide/docs/macros/macros-intro"},next:{title:"Using this Guide",permalink:"/user-guide/docs/macros/using-this-guide"}},l=[{value:"Goals",id:"goals",children:[{value:"Usability",id:"usability",children:[],level:3},{value:"Error Handling",id:"error-handling",children:[],level:3},{value:"Quality of Life",id:"quality-of-life",children:[],level:3}],level:2},{value:"%qc macros",id:"qc-macros",children:[],level:2},{value:"%put result",id:"put-result",children:[],level:2},{value:"Dataset and variable naming",id:"dataset-and-variable-naming",children:[],level:2},{value:"Preserve original dataset",id:"preserve-original-dataset",children:[],level:2},{value:"Don&#39;t assume",id:"dont-assume",children:[],level:2},{value:"Debug Mode",id:"debug-mode",children:[{value:"Example",id:"example",children:[],level:3}],level:2},{value:"Sanitize user inputs",id:"sanitize-user-inputs",children:[],level:2},{value:"%global variable naming",id:"global-variable-naming",children:[],level:2},{value:"Macros used inside a data step",id:"macros-used-inside-a-data-step",children:[{value:"Example",id:"example-1",children:[],level:3}],level:2}],d={toc:l},u="wrapper";function c(e){let{components:a,...t}=e;return(0,n.yg)(u,(0,r.A)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,n.yg)("p",null,"These macro conventions are to improve the usability, reliability, and efficiency of our code.\nMacros defined within your individual programs and used only by you are not required to follow these rules."),(0,n.yg)("h2",{id:"goals"},"Goals"),(0,n.yg)("p",null,"It's important to design our macros in a way that strive to meet the following goals:"),(0,n.yg)("h3",{id:"usability"},"Usability"),(0,n.yg)("p",null,"Macros should be designed in a consistent and simple fashion so users can intuitively use them. "),(0,n.yg)("h3",{id:"error-handling"},"Error Handling"),(0,n.yg)("p",null,"Macro's should implement robust error handling so the user doesn't have to debug a broken macro. If the macro doesn't work, it should provide a message to explain why."),(0,n.yg)("h3",{id:"quality-of-life"},"Quality of Life"),(0,n.yg)("p",null,"Macros should add efficiency to our workflow, not complexity. "),(0,n.yg)("h2",{id:"qc-macros"},"%qc macros"),(0,n.yg)("p",null,"QC macros must adhere to the following rules:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"stored in the ",(0,n.yg)("inlineCode",{parentName:"li"},"\\Macros\\QC")," subfolder"),(0,n.yg)("li",{parentName:"ul"},"must use the same name as production version with ",(0,n.yg)("inlineCode",{parentName:"li"},"qc_")," prefix"),(0,n.yg)("li",{parentName:"ul"},"must use the same parameters and order as production version"),(0,n.yg)("li",{parentName:"ul"},"must produce the same outcomes as production version")),(0,n.yg)("h2",{id:"put-result"},"%put result"),(0,n.yg)("p",null,"If your macro produces a dataset or output for the user, %put a simple and helpful messages at the end of the macro telling the user this information such as the name and/or where it is located."),(0,n.yg)("h2",{id:"dataset-and-variable-naming"},"Dataset and variable naming"),(0,n.yg)("p",null,"Prefix all temporary datasets and variables created inside a macro with ",(0,n.yg)("inlineCode",{parentName:"p"},"_macro name acronym_"),". For example, in %proc","_","compare, all datasets are prefixed with ",(0,n.yg)("inlineCode",{parentName:"p"},"_pc_"),". The exception to this rule is when you want to provide the user or subsequent macros with a dataset (e.g. %importProgLog creates ",(0,n.yg)("em",{parentName:"p"},"_","programminglog"),", %rtfbreak creates ",(0,n.yg)("em",{parentName:"p"},"cellwidth")," and ",(0,n.yg)("em",{parentName:"p"},"style","_","guide")," datasets, %presdtm creates controlled terminology datasets). This accomplishes the following:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Sorts all temp datasets after other datasets that don\u2019t start with an underscore"),(0,n.yg)("li",{parentName:"ul"},"Declutters the user\u2019s working dataset library with only necessary datasets so they can find things easier (in combination with next standard)"),(0,n.yg)("li",{parentName:"ul"},"Avoids clashes with existing datasets"),(0,n.yg)("li",{parentName:"ul"},"The macro tracker has reserved prefixes for macros. For example, %proc","_","compare uses ",(0,n.yg)("inlineCode",{parentName:"li"},"_pc_")," and %progcheck uses ",(0,n.yg)("inlineCode",{parentName:"li"},"_pchk_"))),(0,n.yg)("h2",{id:"preserve-original-dataset"},"Preserve original dataset"),(0,n.yg)("p",null,"Never overwrite or modify the original dataset. Instead, create a new, temporary one inside the macro. The user's original dataset should be left alone, as is the case when you use it in a datastep or procedure."),(0,n.yg)("h2",{id:"dont-assume"},"Don't assume"),(0,n.yg)("p",null,"Unless it's passed as a macro argument don't assume a specific variable exisists. If the macro requires it, you can run a proc contents on the data and provide a log warning for the expectation or have it as a macro parameter."),(0,n.yg)("h2",{id:"debug-mode"},"Debug Mode"),(0,n.yg)("p",null,"By default, macros should do the following:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"delete temporary macro datesets and variables"),(0,n.yg)("li",{parentName:"ul"},"turn off log text while running"),(0,n.yg)("li",{parentName:"ul"},"have a debug parameter the user can use to turn debug mode on to preserve all datasets, variables, and log text created by the macro for debugging purposes.")),(0,n.yg)("p",null,"Add debug option to all macros with the following code."),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},"Because we prefixed all datasets with ",(0,n.yg)("inlineCode",{parentName:"li"},"_mm_")," we can delete them all at once. However, if you need to debug you can bring them back with the debug option ",(0,n.yg)("inlineCode",{parentName:"li"},"%my_macro(debug=1);")," or ",(0,n.yg)("inlineCode",{parentName:"li"},"%my_macro(debug=Y);"))),(0,n.yg)("h3",{id:"example"},"Example"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-sas"},'%macro my_macro(param1, param2, param3, debug=0);\n    %if "&debug" = "0" %then %do;\n        options nonotes nomprint;\n    %end;\n\n    /*\n    my_macro code\n    */\n \n    ** unless debug = 1 or debug = Y is provided, delete all temp datasets **;\n    %if "&debug" = "0" %then %do;\n        proc datasets library=work memtype=data nolist;\n            delete _mm_:;\n        quit;\n    %end;\n\n    %if "&debug" = "0" %then %do;\n      options notes mprint;\n    %end;\n%mend my_macro;\n')),(0,n.yg)("h2",{id:"sanitize-user-inputs"},"Sanitize user inputs"),(0,n.yg)("p",null,"Sanitize all user inputs so they don\u2019t have to remember if the macro is expecting uppercase, lowercase, or a certain value. If the user then inputs something unexpected, provide a log warning that notifies the user of the macro's expectation."),(0,n.yg)("h2",{id:"global-variable-naming"},"%global variable naming"),(0,n.yg)("p",null,"If you absolutely need to create a %global macro variable for another macro, prefix it with the same dataset and variable prefix ",(0,n.yg)("inlineCode",{parentName:"p"},"_macro name acronym_")," to avoid clashing with other macro variables."),(0,n.yg)("h2",{id:"macros-used-inside-a-data-step"},"Macros used inside a data step"),(0,n.yg)("p",null,"If a macro is used inside a data step such as ",(0,n.yg)("inlineCode",{parentName:"p"},"%iso8601")," or ",(0,n.yg)("inlineCode",{parentName:"p"},"%propcase")," we have less flexibility with some of the above standards, but we can still apply the same principles. In this example we prefix the variables created by ",(0,n.yg)("inlineCode",{parentName:"p"},"%procase")," with ",(0,n.yg)("inlineCode",{parentName:"p"},"_prop_"),", and that allows us to avoid clashes and delete the temporary macro variables by default. If the user turns on debug mode then it will keep the temporary macro variables."),(0,n.yg)("h3",{id:"example-1"},"Example"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-sas"},'%macro propcase(var, debug=0);\n\n    ** %propcase code **;\n    length _prop_word1 - _prop_word40 $12;\n\n    %if "&debug" = "0" %then %do;\n          drop _prop_:;\n    %end;\n\n    %put %upcase(NO)TE:(EB) PROPCASE - %upcase(&var) has been propcased ignoring title words.;\n\n%mend;\n')))}c.isMDXComponent=!0},5680:(e,a,t)=>{t.d(a,{xA:()=>u,yg:()=>g});var r=t(6540);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function i(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?i(Object(t),!0).forEach(function(a){n(e,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}function s(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var l=r.createContext({}),d=function(e){var a=r.useContext(l),t=a;return e&&(t="function"==typeof e?e(a):o(o({},a),e)),t},u=function(e){var a=d(e.components);return r.createElement(l.Provider,{value:a},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},m=r.forwardRef(function(e,a){var t=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=d(t),m=n,g=c["".concat(l,".").concat(m)]||c[m]||p[m]||i;return t?r.createElement(g,o(o({ref:a},u),{},{components:t})):r.createElement(g,o({ref:a},u))});function g(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var i=t.length,o=new Array(i);o[0]=m;var s={};for(var l in a)hasOwnProperty.call(a,l)&&(s[l]=a[l]);s.originalType=e,s[c]="string"==typeof e?e:n,o[1]=s;for(var d=2;d<i;d++)o[d]=t[d];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);